data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
CA_map_list = list()
for (n in 1940:1964) {
data = CAs_hom_ct_yr %>% filter(year == n)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste("Homicides in", n))
CA_map_list[[n-1939]] = map
rm(n, data, map)
}
tmap_animation(CA_map_list, "CA_map_list.gif", width = 400, height = 500, delay = 50)
CA_map_list = list()
for (n in 1940:1964) {
data = CAs_hom_ct_yr %>% filter(year == n)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste("Homicides in", n))
CA_map_list[[n-1939]] = map
rm(n, data, map)
}
tmap_animation(CA_map_list, "CA_map_list.gif", width = 400, height = 500, delay = 50)
tmap_mode("view")
tm_shape(hexagons_hom_ct) + tm_polygons(col = "hom_ct", breaks = c(0,1,5,10,50,100,Inf), title="Homicides", id="hom_ct", popup.vars = c("Grid ID:" = "GRID_ID", "Homicides:" = "hom_ct"))
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
View(hexagons_hom_ct_yr)
View(pt2_after_only)
View(pt2_after_aggregated)
View(hexagons_hom_ct_yr)
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
#aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
class(data)
aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
class(data)
#aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
#aggregated_data = aggregate(.~GRID_ID, data = data, FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, map)
}
View(data)
View(aggregated_data)
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(data, by = GRID_ID)
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(data, by = "GRID_ID")
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(data, by = "GRID_ID")
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
View(aggregated_data)
View(hexagons)
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID")
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
rm(n, data, map)
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4)) %>% select(GRID_ID, hom_ct)
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID")
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
View(aggregated_data)
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
print(paste(class(data)))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID")
map = tm_shape(data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
View(aggregated_data)
View(CAs_hom_ct_yr)
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID")
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1")
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, map)
}
View(aggregated_data)
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
print(paste(aggregated_data[aggregated_data$community == "NEAR WEST SIDE", 2]))
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
print(paste(aggregated_data[aggregated_data$community == "NEAR WEST SIDE", 1]))
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
print(paste(aggregated_data[aggregated_data$community == "NEAR WEST SIDE", 1:2]))
rm(n, data, aggregated_data, map)
}
hex_map_list_5yr = list()
CA_map_list_5yr = list()
for (n in seq(1940, 1964, 5)) {
data = hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
hex_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1940, 1964, 5)) {
data = CAs_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$area_num_1), FUN = sum) %>% rename(area_num_1 = Group.1, hom_ct = x) %>% left_join(CAs, by = "area_num_1") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, 100, Inf), title = paste0("Homicides in ", n, "-", n+4))
CA_map_list_5yr[[1+((n-1940)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(hex_map_list_5yr, "hex_map_list_5yr.gif", width = 400, height = 500, delay = 100)
tmap_animation(CA_map_list_5yr, "CA_map_list_5yr.gif", width = 400, height = 500, delay = 100)
1930-1874
2020-19645
2020-1965
seq(1875, 1929, 5)
seq(1965, 2020, 5)
seq(1965, 2019, 5)
pt2_map_list_before = list()
pt2_map_list_after = list()
for (n in seq(1875, 1929, 5)) {
data = pt2_hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
pt2_map_list_before[[1+((n-1875)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1965, 2019, 5)) {
data = pt2_hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
pt2_map_list_after[[1+((n-1965)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(pt2_map_list_before, "hex_map_list_before.gif", width = 400, height = 500, delay = 100)
tmap_animation(pt2_map_list_after, "hex_map_list_after.gif", width = 400, height = 500, delay = 100)
View(pt2_hexagons_yr)
View(pt2_hex_freq_table_yr)
pt2_map_list_before = list()
pt2_map_list_after = list()
for (n in seq(1875, 1929, 5)) {
data = pt2_hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
pt2_map_list_before[[1+((n-1875)/5)]] = map
rm(n, data, aggregated_data, map)
}
for (n in seq(1965, 2014, 5)) {
data = pt2_hexagons_hom_ct_yr %>% filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>% rename(GRID_ID = Group.1, hom_ct = x) %>% left_join(hexagons, by = "GRID_ID") %>% st_as_sf()
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_ct", breaks = c(0, 1, 5, 10, 50, Inf), title = paste0("Homicides in ", n, "-", n+4))
pt2_map_list_after[[1+((n-1965)/5)]] = map
rm(n, data, aggregated_data, map)
}
tmap_animation(pt2_map_list_before, "hex_map_list_before.gif", width = 400, height = 500, delay = 100)
tmap_animation(pt2_map_list_after, "hex_map_list_after.gif", width = 400, height = 500, delay = 100)
knitr::opts_chunk$set(echo = TRUE)
tmap_animation(c(pt2_map_list_before, hex_map_list_5yr, pt2_map_list_after), "hex_map_list_all.gif", width = 400, height = 500, delay = 100)
library(sf)
library(dplyr)
library(tmap)
library(leaflet)
library(leafgl)
library(crosstalk)
library(sfdep)
tmap_animation(c(pt2_map_list_before, hex_map_list_5yr, pt2_map_list_after), "hex_map_list_all.gif", width = 400, height = 500, delay = 100)
View(CAs_hom_ct_yr)
View(CA_freq_table_yr)
View(CAs)
annexed_CAs = read.csv("annexed/annexed.csv")
View(annexed_CAs)
rm(annexed_CAs)
annexed_CAs = read.csv("annexed/annexed.csv")
View(annexed_CAs)
View(annexed_CAs)
rm(annexed_CAs)
annexed = CAs_hom_ct_yr %>% left_join(annexed_CAs, by="community")
annexed_CAs = read.csv("annexed/annexed.csv")
View(annexed_CAs)
annexed = CAs_hom_ct_yr %>% left_join(annexed_CAs, by="community")
View(annexed)
annexed = CAs_hom_ct_yr %>% left_join(annexed_CAs, by="community") %>% mutate(annexed = ifelse(is.na(annexed), 0, annexed))
View(annexed)
annexed = CAs_hom_ct_yr %>% left_join(annexed_CAs, by="community") %>% mutate(annexed = ifelse(is.na(annexed), 0, annexed)) %>% select(area_num_1, year, community, hom_ct, annexed) %>% st_drop_geometry()
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum)
View(annexed_aggregated)
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% rename(year = Group.1, annexed = Group.2, hom_ct = x)
reshape(annexed_aggregated, idvar = "year", timevar = "annexed", direction = "wide")
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum)
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% reshape(idvar = "Group.1", timevar = "Group.2", direction = "wide")
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% reshape(idvar = "Group.1", timevar = "Group.2", direction = "wide") %>% rename(year = Group.1, hom_ct_notannexed = x.0, hom_ct_annexed = x.1)
plot(annexed_aggregated)
plot(annexed_aggregated, type="o")
plot(annexed_aggregated, type= "o")
library(ggplot2)
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct_annexed, group=1)) +
geom_line()+
geom_point()
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% rename(year = Group.1)
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% rename(year = Group.1, annexed = Group.2, hom_ct = x)
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line()+
geom_point()
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed)) +
geom_point()
annexed = CAs_hom_ct_yr %>% left_join(annexed_CAs, by="community") %>% mutate(annexed = ifelse(is.na(annexed), "Not Annexed", "Annexed")) %>% select(area_num_1, year, community, hom_ct, annexed) %>% st_drop_geometry()
annexed_aggregated = aggregate(annexed$hom_ct, list(annexed$year, annexed$annexed), FUN = sum) %>% rename(year = Group.1, annexed = Group.2, hom_ct = x)
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed)) +
geom_point()
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed), width = 1) +
geom_point()
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed), width = 10) +
geom_point()
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed), size = 10) +
geom_point()
# Line Graph
ggplot(data = annexed_aggregated, aes(x = year, y = hom_ct, group = annexed)) +
geom_line(aes(color = annexed), size = 1) +
geom_point()
knitr::opts_chunk$set(echo = TRUE)
pt4_data = left_join(pt2_hexagons_hom_ct_yr_ALL, hex_bldgs, by = c("GRID_ID", "year")) %>%
select(GRID_ID, year, hom_ct, bldg_ct = weighted_building_count) %>%
mutate(hom_rt = hom_ct / bldg_ct) %>%
mutate(hom_rt = ifelse(hom_rt == Inf, NA, hom_rt))
library(sf)
library(dplyr)
library(tmap)
library(leaflet)
library(leafgl)
library(crosstalk)
library(sfdep)
library(ggplot2)
pt4_data = left_join(pt2_hexagons_hom_ct_yr_ALL, hex_bldgs, by = c("GRID_ID", "year")) %>%
select(GRID_ID, year, hom_ct, bldg_ct = weighted_building_count) %>%
mutate(hom_rt = hom_ct / bldg_ct) %>%
mutate(hom_rt = ifelse(hom_rt == Inf, NA, hom_rt))
pt2_hexagons_hom_ct_yr_ALL = rbind(hexagons_hom_ct_yr, pt2_hexagons_hom_ct_yr)
View(pt2_hexagons_hom_ct_yr_ALL)
# Create an expanded grid of hexagons that includes each hex/year combo
pt2_hexagons_yr = expand.grid(GRID_ID = hexagons$GRID_ID, year = c(1874:1930, 1965:2016)) %>%
left_join(hexagons, by = "GRID_ID") %>%
st_as_sf()
# Merge into hexagons
pt2_hexagons_hom_ct_yr = pt2_hexagons_yr %>%
left_join(pt2_hex_freq_table_yr, join_by(GRID_ID, year))
pt4_data = left_join(pt2_hexagons_hom_ct_yr_ALL, hex_bldgs, by = c("GRID_ID", "year")) %>%
select(GRID_ID, year, hom_ct, bldg_ct = weighted_building_count) %>%
mutate(hom_rt = hom_ct / bldg_ct) %>%
mutate(hom_rt = ifelse(hom_rt == Inf, NA, hom_rt))
hex_bldgs = read.csv("hexagons/hex_building_counts.csv")
pt2_hexagons_hom_ct_yr_ALL = rbind(hexagons_hom_ct_yr, pt2_hexagons_hom_ct_yr)
pt2_map_list_bldgs = list()
pt2_map_list_bldg_weighted = list()
for (n in seq(1875, 2014, 5)) {
if (n < 1930 | n > 1939) {
# Homicide data
data = pt2_hexagons_hom_ct_yr_ALL %>%
filter(between(year, n, n+4))
aggregated_data = aggregate(data$hom_ct, list(data$GRID_ID), FUN = sum) %>%
rename(GRID_ID = Group.1, hom_ct = x) %>%
left_join(hexagons, by = "GRID_ID") %>%
st_as_sf()
# Building data
bldgs = hex_bldgs %>%
filter(between(year, n, n+4))
aggregated_bldgs = aggregate(bldgs$weighted_building_count, list(bldgs$GRID_ID), FUN = mean) %>%
rename(GRID_ID = Group.1, bldg_ct = x)
# Combined data
aggregated_data = aggregated_data %>%
left_join(aggregated_bldgs, by = "GRID_ID") %>%
mutate(hom_rt = hom_ct / bldg_ct) %>%
mutate(hom_rt = ifelse(hom_rt == Inf, NA, hom_rt))
# Maps
bldgs_map = tm_shape(aggregated_data) + tm_polygons(col = "bldg_ct", breaks = c(0,1,5,10,50,100,500,1000,Inf), title = paste0("Buildings in ", n, "-", n+4))
map = tm_shape(aggregated_data) + tm_polygons(col = "hom_rt", breaks = c(0, 0.001, 0.01, 0.1, 1, 10), title = paste0("Homicides per building in ", n, "-", n+4))
pt2_map_list_bldgs[[1+length(pt2_map_list_bldgs)]] = bldgs_map
pt2_map_list_bldg_weighted[[1+length(pt2_map_list_bldg_weighted)]] = map
rm(n, data, aggregated_data, bldgs, aggregated_bldgs, map)
}
}
pt4_data = left_join(pt2_hexagons_hom_ct_yr_ALL, hex_bldgs, by = c("GRID_ID", "year")) %>%
select(GRID_ID, year, hom_ct, bldg_ct = weighted_building_count) %>%
mutate(hom_rt = hom_ct / bldg_ct) %>%
mutate(hom_rt = ifelse(hom_rt == Inf, NA, hom_rt))
annexed_areas = read_sf("annexed/annexed_areas/Annexed Settlements.shp") %>%
st_transform(st_crs(hexagons))
hexagons_annexed = hexagons %>%
st_centroid() %>%
st_join(annexed_areas, join = st_within) %>%
select(-year) %>%
mutate(annex_category = case_when(
settlement == "CHICAGO" ~ "Original",
is.na(settlement) ~ "Incorporated",
settlement == "LAKE" | settlement == "JEFFERSON" ~ "Annexed - Sparse",
.default = "Annexed - Populated"
)) %>%
st_drop_geometry() %>%
left_join(hexagons, ., by="GRID_ID") %>%
select(GRID_ID, settlement, annex_category)
hexagons_annexed = hexagons %>%
st_centroid() %>%
st_join(annexed_areas, join = st_within) %>%
select(-year) %>%
mutate(annex_category = case_when(
settlement == "CHICAGO" ~ "Original",
is.na(settlement) ~ "Incorporated",
settlement == "LAKE" | settlement == "JEFFERSON" ~ "Annexed - Sparse",
.default = "Annexed - Populated"
)) %>%
st_drop_geometry() %>%
left_join(hexagons, ., by="GRID_ID") %>%
select(GRID_ID, settlement, annex_category)
tmap_mode("view")
tm_shape(hexagons_annexed) + tm_polygons(col = "annex_category", title="Annexation Category", id="annex_category", popup.vars = c("Grid ID:" = "GRID_ID", "Settlement:" = "settlement", "Annexation Category:" = "annex_category"))
pt4_annexed = left_join(pt4_data, st_drop_geometry(hexagons_annexed), by = "GRID_ID") %>%
st_drop_geometry()
pt4_annexed = left_join(pt4_data, st_drop_geometry(hexagons_annexed), by = "GRID_ID") %>%
st_drop_geometry()
pt4_annexed_aggregated = pt4_annexed %>%
group_by(year, annex_category) %>%
summarise(hom_ct = sum(hom_ct), bldg_ct = sum(bldg_ct)) %>%
mutate(hom_rt = hom_ct / bldg_ct)
# Line Graph
ggplot(data = pt4_annexed_aggregated, aes(x = year, y = hom_rt, group = annex_category)) +
geom_line(aes(color = annex_category), size = 1) +
ylab("Homicides per Building") +
xlab("Year")
